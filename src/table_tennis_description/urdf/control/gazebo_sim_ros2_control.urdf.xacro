<?xml version="1.0"?>
<robot xmlns:xacro="http://wiki.ros.org/xacro">
    
    <xacro:macro name="load_gazebo_sim_ros2_control_plugin" params="robot_name use_gazebo namespace:=''">
        <xacro:if value="${use_gazebo}">
            <gazebo>
                <plugin filename="gz_ros2_control-system" name="gz_ros2_control::GazeboSimROS2ControlPlugin">
                    <!-- CRITICAL: Use wildcarded YAML for namespace support -->
                    <parameters>$(find table_tennis_gazebo)/config/controllers_namespaced.yaml</parameters>
                    
                    <!-- Optional: keep default controller_manager name -->
                    <controller_manager_name>controller_manager</controller_manager_name>
                    
                    <!-- CRITICAL: namespace must NOT have leading slash -->
                    <ros>
                        <namespace>${namespace}</namespace>
                        <remapping>/robot_description:=${namespace + '/' if namespace else ''}robot_description</remapping>
                    </ros>
                </plugin>
            </gazebo>
        </xacro:if>
    </xacro:macro>
    
</robot>
